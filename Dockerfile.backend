FROM ghcr.io/puppeteer/puppeteer:latest

WORKDIR /app
ENV TZ=America/Sao_Paulo \
    PUPPETEER_SKIP_DOWNLOAD=true \
    PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium

# copie manifestos antes p/ cache
COPY package*.json ./

# garanta permissão para o pptruser
USER 0
RUN chown -R pptruser:pptruser /app
USER pptruser

# instale deps como não-root
RUN npm ci --omit=dev

# copie o resto do código já com owner correto
COPY --chown=pptruser:pptruser . .

EXPOSE 3009
CMD ["node", "index.js"]
